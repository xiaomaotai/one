# 浅色模式侧边栏 Bug 修复设计

## 概述

修复浅色模式下侧边栏打开时的 UI 显示问题。主要问题包括：
1. 系统通知栏文字颜色与背景对比度不足
2. 主内容区域颜色与浅色主题不一致
3. 侧边栏关闭后主题状态未正确恢复

## 架构

### 主题系统架构

```
App.tsx (应用根组件)
  ├── 读取主题状态
  ├── 应用主题类到 document.documentElement
  └── 传递给所有子组件

MainLayout.tsx (主布局)
  ├── 监听主题变化
  ├── 更新系统状态栏样式（原生平台）
  ├── 管理侧边栏打开/关闭状态
  └── 根据主题应用背景颜色

Sidebar.tsx (侧边栏)
  └── 根据主题应用背景和文字颜色
```

## 组件和接口

### MainLayout 组件职责

1. **主题监听**: 监听主题变化，及时更新系统状态栏
2. **状态栏管理**: 根据侧边栏打开状态和主题，更新系统状态栏样式
3. **背景颜色**: 确保主内容区域背景颜色与主题一致

### 关键修复点

#### 1. 系统状态栏样式更新

**问题**: 侧边栏打开时，系统状态栏的文字颜色没有根据侧边栏背景颜色调整

**解决方案**:
- 在 MainLayout 中添加 `sidebarOpen` 状态到依赖数组
- 当侧边栏打开时，根据主题更新状态栏样式
- 当侧边栏关闭时，恢复原始状态栏样式

```typescript
useEffect(() => {
  if (isNative && sidebarOpen) {
    // 侧边栏打开时，根据主题更新状态栏
    updateStatusBar(isDark);
  } else if (isNative && !sidebarOpen) {
    // 侧边栏关闭时，恢复状态栏
    updateStatusBar(isDark);
  }
}, [isDark, sidebarOpen, isNative]);
```

#### 2. 主内容区域背景颜色

**问题**: 浅色模式下，主内容区域背景色不正确

**解决方案**:
- 检查 MainLayout 的 main 元素背景颜色类
- 确保在浅色模式下使用 `bg-white` 而不是 `bg-gray-100`
- 在深色模式下使用 `bg-gray-800`

#### 3. 遮罩层颜色

**问题**: 遮罩层可能影响背景颜色的显示

**解决方案**:
- 确保遮罩层使用 `bg-black bg-opacity-50` 的半透明效果
- 遮罩层不应该改变背景颜色，只是降低可见度

## 数据模型

无新增数据模型，仅涉及现有的主题状态管理。

## 正确性属性

### 属性 1: 主题一致性
*对于任何* 主题状态和侧边栏打开/关闭状态的组合，系统状态栏、主内容区域和侧边栏的背景颜色应该与当前主题一致。

**验证**: Requirements 1.1, 1.2, 2.1, 2.2, 3.1, 3.2

### 属性 2: 文字可见性
*对于任何* 主题状态，所有文字的颜色对比度应该满足 WCAG AA 标准（最小对比度 4.5:1）。

**验证**: Requirements 1.1, 3.1, 3.3

### 属性 3: 状态恢复
*对于任何* 侧边栏打开后关闭的操作，系统状态栏和主内容区域应该恢复到侧边栏打开前的样式。

**验证**: Requirements 3.1, 3.2, 3.3

## 错误处理

- 如果原生平台状态栏更新失败，记录错误但不中断应用
- 如果主题状态获取失败，默认使用深色模式

## 测试策略

### 单元测试

1. 测试主题切换时状态栏样式是否正确更新
2. 测试侧边栏打开/关闭时背景颜色是否正确应用
3. 测试浅色和深色模式下的颜色对比度

### 集成测试

1. 在浅色模式下打开侧边栏，验证系统状态栏文字可见
2. 在浅色模式下打开侧边栏，验证主内容区域背景颜色
3. 在浅色模式下打开后关闭侧边栏，验证主题恢复

### 手动测试

1. 在真实设备上测试浅色模式下的侧边栏
2. 验证系统通知栏文字清晰度
3. 验证颜色过渡的平滑性

</content>
</invoke>